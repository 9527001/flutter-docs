<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flutter Engine æ¨¡å—æµç¨‹å›¾ - æ€ç»´å¯¼å›¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: auto;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .mindmap-container {
            padding: 40px;
            background: #f8f9fa;
            min-height: 800px;
            position: relative;
            overflow: auto;
        }

        .mindmap {
            position: relative;
            width: 100%;
            min-height: 2000px;
        }

        /* ä¸­å¿ƒèŠ‚ç‚¹ */
        .root-node {
            position: absolute;
            left: 50%;
            top: 50px;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            border-radius: 12px;
            font-size: 24px;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s;
        }

        .root-node:hover {
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        /* ä¸€çº§èŠ‚ç‚¹ */
        .level1-node {
            position: absolute;
            background: white;
            border: 3px solid #667eea;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            color: #333;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 9;
            min-width: 180px;
            text-align: center;
            white-space: pre-line;
        }

        .level1-node:hover {
            background: #f0f4ff;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .level1-node.expanded {
            background: #e8f0ff;
            border-color: #4caf50;
        }

        /* äºŒçº§èŠ‚ç‚¹ */
        .level2-node {
            position: absolute;
            background: #f8f9fa;
            border: 2px solid #2196f3;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            color: #555;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 8;
            min-width: 150px;
            text-align: center;
            white-space: pre-line;
        }

        .level2-node:hover {
            background: #e3f2fd;
            transform: scale(1.05);
            border-color: #1976d2;
        }

        /* ä¸‰çº§èŠ‚ç‚¹ */
        .level3-node {
            position: absolute;
            background: #fff;
            border: 1px solid #ff9800;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            color: #666;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 7;
            min-width: 120px;
            text-align: center;
        }

        .level3-node:hover {
            background: #fff3e0;
            border-color: #f57c00;
            transform: scale(1.05);
        }

        /* è¿æ¥çº¿ */
        .connection-line {
            position: absolute;
            stroke: #999;
            stroke-width: 2;
            fill: none;
            z-index: 1;
            transition: all 0.3s;
        }

        .connection-line.active {
            stroke: #667eea;
            stroke-width: 3;
        }

        /* è¯¦æƒ…é¢æ¿ */
        .detail-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.2);
            transition: right 0.3s;
            z-index: 1000;
            overflow-y: auto;
        }

        .detail-panel.show {
            right: 0;
        }

        .detail-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-size: 20px;
            font-weight: 600;
        }

        .detail-close {
            float: right;
            cursor: pointer;
            font-size: 24px;
            opacity: 0.8;
        }

        .detail-close:hover {
            opacity: 1;
        }

        .detail-content {
            padding: 20px;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .detail-section p {
            color: #666;
            line-height: 1.6;
            font-size: 14px;
        }

        .detail-section ul {
            margin-left: 20px;
            color: #666;
            line-height: 1.8;
        }

        .detail-section code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'SF Mono', monospace;
            font-size: 13px;
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .control-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        /* å“åº”å¼ */
        @media (max-width: 1200px) {
            .mindmap-container {
                padding: 20px;
            }
            
            .level1-node {
                font-size: 16px;
                padding: 12px 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  Flutter Engine æ¨¡å—æµç¨‹å›¾</h1>
            <p>äº¤äº’å¼æ€ç»´å¯¼å›¾ - å±•ç¤º Flutter Engine çš„å®Œæ•´æ¶æ„å’Œæ¨¡å—å…³ç³»</p>
        </div>

        <div class="mindmap-container">
            <svg class="mindmap" id="mindmapSvg" style="width: 100%; height: 2000px;"></svg>
            <div class="mindmap" id="mindmapNodes"></div>
        </div>
    </div>

    <div class="detail-panel" id="detailPanel">
        <div class="detail-header">
            <span id="detailTitle">æ¨¡å—è¯¦æƒ…</span>
            <span class="detail-close" id="detailClose">Ã—</span>
        </div>
        <div class="detail-content" id="detailContent"></div>
    </div>

    <div class="control-panel">
        <button class="control-btn" id="expandAllBtn">å±•å¼€å…¨éƒ¨</button>
        <button class="control-btn" id="collapseAllBtn">æ”¶èµ·å…¨éƒ¨</button>
        <button class="control-btn" id="resetViewBtn">é‡ç½®è§†å›¾</button>
    </div>

    <script>
        // æ¨¡å—æ•°æ®å®šä¹‰
        const modules = {
            root: {
                id: 'root',
                title: 'Flutter Engine',
                x: 0,
                y: 0,
                level: 0,
                description: 'Flutter Engine æ˜¯ Flutter æ¡†æ¶çš„æ ¸å¿ƒæ¸²æŸ“å¼•æ“ï¼Œè´Ÿè´£å°† Widget æ ‘è½¬æ¢ä¸ºå±å¹•ä¸Šçš„åƒç´ ã€‚',
                details: {
                    'æ ¸å¿ƒèŒè´£': [
                        'å°†å£°æ˜å¼ UI è½¬æ¢ä¸ºæ¸²æŸ“å‘½ä»¤',
                        'ç®¡ç†ä¸‰æ£µæ ‘ï¼ˆWidgetã€Elementã€RenderObjectï¼‰',
                        'æ‰§è¡Œå¸ƒå±€ã€ç»˜åˆ¶ã€åˆæˆæµç¨‹',
                        'ä¸å¹³å°å±‚äº¤äº’'
                    ],
                    'è®¾è®¡åŸåˆ™': [
                        'å£°æ˜å¼ UI ç¼–ç¨‹æ¨¡å‹',
                        'é«˜æ€§èƒ½æ¸²æŸ“ï¼ˆ60fps/120fpsï¼‰',
                        'è·¨å¹³å°ä¸€è‡´æ€§',
                        'å¯æ‰©å±•çš„æ¶æ„'
                    ]
                }
            },
            framework: {
                id: 'framework',
                title: 'Framework Layer\næ¡†æ¶å±‚',
                x: -400,
                y: 200,
                level: 1,
                parent: 'root',
                description: 'Flutter Framework æä¾›å£°æ˜å¼ UI APIï¼ŒåŒ…æ‹¬ Widgetã€Elementã€RenderObject ä¸‰æ£µæ ‘ç³»ç»Ÿã€‚',
                details: {
                    'æ ¸å¿ƒç»„ä»¶': [
                        'Widget System - ä¸å¯å˜çš„é…ç½®å¯¹è±¡',
                        'Element System - ç”Ÿå‘½å‘¨æœŸç®¡ç†',
                        'RenderObject System - æ¸²æŸ“å¯¹è±¡',
                        'State Management - çŠ¶æ€ç®¡ç†'
                    ],
                    'ä¸»è¦åŠŸèƒ½': [
                        'æ„å»º Widget æ ‘',
                        'ç®¡ç† Element ç”Ÿå‘½å‘¨æœŸ',
                        'Diff ç®—æ³•ä¼˜åŒ–',
                        'çŠ¶æ€æ›´æ–°æœºåˆ¶'
                    ]
                }
            },
            rendering: {
                id: 'rendering',
                title: 'Rendering Pipeline\næ¸²æŸ“ç®¡çº¿',
                x: 0,
                y: 200,
                level: 1,
                parent: 'root',
                description: 'æ¸²æŸ“ç®¡çº¿è´Ÿè´£å°† RenderObject æ ‘è½¬æ¢ä¸ºå±å¹•åƒç´ ï¼ŒåŒ…æ‹¬å¸ƒå±€ã€ç»˜åˆ¶ã€åˆæˆä¸‰ä¸ªé˜¶æ®µã€‚',
                details: {
                    'ä¸‰ä¸ªé˜¶æ®µ': [
                        'Layout Phase - å¸ƒå±€é˜¶æ®µ',
                        'Paint Phase - ç»˜åˆ¶é˜¶æ®µ',
                        'Composite Phase - åˆæˆé˜¶æ®µ'
                    ],
                    'æ ¸å¿ƒæµç¨‹': [
                        'Constraints go downï¼ˆçº¦æŸå‘ä¸‹ä¼ é€’ï¼‰',
                        'Sizes go upï¼ˆå°ºå¯¸å‘ä¸Šè¿”å›ï¼‰',
                        'Parent sets positionï¼ˆçˆ¶å†³å®šä½ç½®ï¼‰',
                        'Layer Tree æ„å»ºå’Œåˆæˆ'
                    ]
                }
            },
            platform: {
                id: 'platform',
                title: 'Platform Layer\nå¹³å°å±‚',
                x: 400,
                y: 200,
                level: 1,
                parent: 'root',
                description: 'å¹³å°æŠ½è±¡å±‚æä¾›è·¨å¹³å°çš„æ¸²æŸ“åç«¯å’Œå¹³å°é€šé“ï¼Œæ”¯æŒ Androidã€iOSã€Webã€Desktop ç­‰å¹³å°ã€‚',
                details: {
                    'æ¸²æŸ“åç«¯': [
                        'Skia - 2D å›¾å½¢åº“',
                        'Metal - iOS/macOS GPU',
                        'Vulkan - è·¨å¹³å° GPU',
                        'WebGL - Web å¹³å°'
                    ],
                    'å¹³å°é€šé“': [
                        'Method Channel - æ–¹æ³•è°ƒç”¨',
                        'Event Channel - äº‹ä»¶æµ',
                        'Platform Views - åŸç”Ÿè§†å›¾åµŒå…¥'
                    ]
                }
            },
            // Framework å­æ¨¡å—
            widgetSystem: {
                id: 'widgetSystem',
                title: 'Widget System',
                x: -600,
                y: 400,
                level: 2,
                parent: 'framework',
                description: 'Widget æ˜¯ä¸å¯å˜çš„é…ç½®å¯¹è±¡ï¼Œæè¿° UI åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ã€‚',
                details: {
                    'ç‰¹ç‚¹': [
                        'ä¸å¯å˜ï¼ˆImmutableï¼‰',
                        'è½»é‡çº§ï¼Œå¯é¢‘ç¹åˆ›å»º',
                        'çº¯å‡½æ•°å¼æ„å»º',
                        'æ”¯æŒç»„åˆæ¨¡å¼'
                    ],
                    'ç±»å‹': [
                        'StatelessWidget - æ— çŠ¶æ€ç»„ä»¶',
                        'StatefulWidget - æœ‰çŠ¶æ€ç»„ä»¶',
                        'InheritedWidget - æ•°æ®å…±äº«',
                        'ProxyWidget - ä»£ç†ç»„ä»¶'
                    ]
                }
            },
            elementSystem: {
                id: 'elementSystem',
                title: 'Element System',
                x: -400,
                y: 400,
                level: 2,
                parent: 'framework',
                description: 'Element æ˜¯ Widget çš„å®ä¾‹åŒ–ï¼Œè´Ÿè´£ç®¡ç†ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€ï¼Œæ‰§è¡Œ diff ç®—æ³•ã€‚',
                details: {
                    'èŒè´£': [
                        'Widget å®ä¾‹åŒ–',
                        'ç”Ÿå‘½å‘¨æœŸç®¡ç†',
                        'Diff ç®—æ³•æ‰§è¡Œ',
                        'RenderObject å…³è”'
                    ],
                    'ä¼˜åŒ–': [
                        'Element å¤ç”¨æœºåˆ¶',
                        'å¢é‡æ›´æ–°ç­–ç•¥',
                        'Key æœºåˆ¶æ”¯æŒ',
                        'æœ€å°åŒ–é‡å»º'
                    ]
                }
            },
            renderObjectSystem: {
                id: 'renderObjectSystem',
                title: 'RenderObject System',
                x: -200,
                y: 400,
                level: 2,
                parent: 'framework',
                description: 'RenderObject è´Ÿè´£å®é™…çš„å¸ƒå±€å’Œç»˜åˆ¶ï¼Œæ˜¯æ¸²æŸ“æ ‘çš„æ ¸å¿ƒèŠ‚ç‚¹ã€‚',
                details: {
                    'æ ¸å¿ƒæ–¹æ³•': [
                        'layout() - å¸ƒå±€è®¡ç®—',
                        'paint() - ç»˜åˆ¶å‘½ä»¤ç”Ÿæˆ',
                        'hitTest() - ç‚¹å‡»æµ‹è¯•',
                        'composite() - åˆæˆå¤„ç†'
                    ],
                    'ç±»å‹': [
                        'RenderBox - ç›’æ¨¡å‹',
                        'RenderSliver - æ»‘åŠ¨å¸ƒå±€',
                        'RenderProxyBox - ä»£ç†æ¨¡å¼',
                        'RenderCustomLayout - è‡ªå®šä¹‰å¸ƒå±€'
                    ]
                }
            },
            // Rendering å­æ¨¡å—
            layoutSystem: {
                id: 'layoutSystem',
                title: 'Layout System\nå¸ƒå±€ç³»ç»Ÿ',
                x: -200,
                y: 400,
                level: 2,
                parent: 'rendering',
                description: 'å¸ƒå±€ç³»ç»Ÿè´Ÿè´£ç¡®å®šæ¯ä¸ª RenderObject çš„å°ºå¯¸å’Œä½ç½®ã€‚',
                details: {
                    'æ ¸å¿ƒåŸåˆ™': [
                        'Constraints go down - çº¦æŸå‘ä¸‹ä¼ é€’',
                        'Sizes go up - å°ºå¯¸å‘ä¸Šè¿”å›',
                        'Parent sets position - çˆ¶å†³å®šä½ç½®'
                    ],
                    'çº¦æŸç±»å‹': [
                        'Tight Constraints - ä¸¥æ ¼çº¦æŸ',
                        'Loose Constraints - å®½æ¾çº¦æŸ',
                        'Bounded Constraints - æœ‰ç•Œçº¦æŸ',
                        'Unbounded Constraints - æ— ç•Œçº¦æŸ'
                    ],
                    'å¸ƒå±€æ¨¡å¼': [
                        'ä»£ç†æ¨¡å¼ï¼ˆ15%ï¼‰',
                        'çº¦æŸä¿®æ”¹æ¨¡å¼ï¼ˆ20%ï¼‰',
                        'å¼¹æ€§å¸ƒå±€æ¨¡å¼ï¼ˆ15%ï¼‰',
                        'å¶å­èŠ‚ç‚¹æ¨¡å¼ï¼ˆ25%ï¼‰'
                    ]
                }
            },
            paintSystem: {
                id: 'paintSystem',
                title: 'Paint System\nç»˜åˆ¶ç³»ç»Ÿ',
                x: 0,
                y: 400,
                level: 2,
                parent: 'rendering',
                description: 'ç»˜åˆ¶ç³»ç»Ÿç”Ÿæˆç»˜åˆ¶å‘½ä»¤ï¼Œæ„å»º Layer Treeï¼Œå‡†å¤‡åˆæˆã€‚',
                details: {
                    'ç»˜åˆ¶æµç¨‹': [
                        'ç”Ÿæˆç»˜åˆ¶å‘½ä»¤',
                        'æ„å»º Layer Tree',
                        'è®°å½•åˆ° PictureLayer',
                        'å‡†å¤‡åˆæˆ'
                    ],
                    'Layer ç±»å‹': [
                        'PictureLayer - ç»˜åˆ¶å‘½ä»¤',
                        'TextureLayer - çº¹ç†',
                        'ContainerLayer - å®¹å™¨å±‚',
                        'OffsetLayer - åç§»å±‚'
                    ],
                    'ä¼˜åŒ–': [
                        'é‡ç»˜åŒºåŸŸä¼˜åŒ–',
                        'ç»˜åˆ¶ç¼“å­˜',
                        'è„åŒºåŸŸæ ‡è®°',
                        'éƒ¨åˆ†é‡ç»˜æ”¯æŒ'
                    ]
                }
            },
            compositingSystem: {
                id: 'compositingSystem',
                title: 'Compositing System\nåˆæˆç³»ç»Ÿ',
                x: 200,
                y: 400,
                level: 2,
                parent: 'rendering',
                description: 'åˆæˆç³»ç»Ÿå°† Layer Tree è½¬æ¢ä¸º GPU å‘½ä»¤ï¼Œåˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿè¿›è¡Œæœ€ç»ˆåˆæˆã€‚',
                details: {
                    'åˆæˆæµç¨‹': [
                        'Layer Tree éå†',
                        'è½¬æ¢ä¸º GPU å‘½ä»¤',
                        'ç¡¬ä»¶åŠ é€Ÿåˆæˆ',
                        'æ˜¾ç¤ºåˆ°å±å¹•'
                    ],
                    'ä¼˜åŒ–æŠ€æœ¯': [
                        'GPU åŠ é€Ÿ',
                        'Layer å¤ç”¨',
                        'åˆæˆæ ‘ä¼˜åŒ–',
                        'å¸§ç¼“å†²ç®¡ç†'
                    ],
                    'æ€§èƒ½ç›®æ ‡': [
                        '60 FPSï¼ˆæ ‡å‡†ï¼‰',
                        '120 FPSï¼ˆé«˜åˆ·æ–°ç‡ï¼‰',
                        'ä½å»¶è¿Ÿæ¸²æŸ“',
                        'æµç•…åŠ¨ç”»'
                    ]
                }
            },
            // Platform å­æ¨¡å—
            renderingBackend: {
                id: 'renderingBackend',
                title: 'Rendering Backend\næ¸²æŸ“åç«¯',
                x: 300,
                y: 400,
                level: 2,
                parent: 'platform',
                description: 'æ¸²æŸ“åç«¯æä¾›åº•å±‚å›¾å½¢ API æŠ½è±¡ï¼Œæ”¯æŒå¤šç§å›¾å½¢åº“ã€‚',
                details: {
                    'æ”¯æŒçš„åç«¯': [
                        'Skia - Google 2D å›¾å½¢åº“',
                        'Metal - Apple GPU API',
                        'Vulkan - Khronos GPU API',
                        'WebGL - Web å›¾å½¢ API'
                    ],
                    'åŠŸèƒ½': [
                        '2D å›¾å½¢ç»˜åˆ¶',
                        'çº¹ç†ç®¡ç†',
                        'ç€è‰²å™¨æ”¯æŒ',
                        'ç¡¬ä»¶åŠ é€Ÿ'
                    ]
                }
            },
            embedder: {
                id: 'embedder',
                title: 'Embedder\nå¹³å°åµŒå…¥å±‚',
                x: 500,
                y: 400,
                level: 2,
                parent: 'platform',
                description: 'Embedder è´Ÿè´£å°† Flutter Engine åµŒå…¥åˆ°å„ä¸ªå¹³å°ï¼Œå¤„ç†å¹³å°ç‰¹å®šçš„é›†æˆã€‚',
                details: {
                    'æ”¯æŒå¹³å°': [
                        'Android - Java/Kotlin',
                        'iOS - Objective-C/Swift',
                        'Web - JavaScript',
                        'Desktop - Windows/macOS/Linux'
                    ],
                    'åŠŸèƒ½': [
                        'çª—å£ç®¡ç†',
                        'è¾“å…¥äº‹ä»¶å¤„ç†',
                        'å¹³å°é€šé“',
                        'èµ„æºç®¡ç†'
                    ]
                }
            }
        };

        // åº”ç”¨çŠ¶æ€
        const app = {
            expandedNodes: new Set(['root']),
            selectedNode: null,
            scale: 1,
            offsetX: 0,
            offsetY: 0
        };

        // åˆå§‹åŒ–
        function init() {
            renderMindmap();
            setupEventListeners();
        }

        // æ¸²æŸ“æ€ç»´å¯¼å›¾
        function renderMindmap() {
            const container = document.getElementById('mindmapNodes');
            const svg = document.getElementById('mindmapSvg');
            
            // æ¸…ç©º
            container.innerHTML = '';
            svg.innerHTML = '';

            // è®¡ç®—ä¸­å¿ƒä½ç½®
            const containerRect = container.getBoundingClientRect();
            const centerX = containerRect.width / 2;
            const centerY = 100;

            // æ¸²æŸ“æ ¹èŠ‚ç‚¹
            renderNode(modules.root, centerX, centerY, container);

            // æ¸²æŸ“ä¸€çº§èŠ‚ç‚¹
            Object.values(modules).forEach(module => {
                if (module.level === 1) {
                    const x = centerX + module.x;
                    const y = centerY + module.y;
                    renderNode(module, x, y, container);
                    renderConnection(svg, centerX, centerY, x, y);
                }
            });

            // æ¸²æŸ“äºŒçº§èŠ‚ç‚¹ï¼ˆå¦‚æœçˆ¶èŠ‚ç‚¹å±•å¼€ï¼‰
            Object.values(modules).forEach(module => {
                if (module.level === 2 && app.expandedNodes.has(module.parent)) {
                    const parent = modules[module.parent];
                    const parentX = centerX + parent.x;
                    const parentY = centerY + parent.y;
                    const x = centerX + module.x;
                    const y = centerY + module.y;
                    renderNode(module, x, y, container);
                    renderConnection(svg, parentX, parentY, x, y);
                }
            });
        }

        // æ¸²æŸ“èŠ‚ç‚¹
        function renderNode(module, x, y, container) {
            const node = document.createElement('div');
            const className = module.level === 0 ? 'root-node' : 
                             module.level === 1 ? 'level1-node' : 
                             module.level === 2 ? 'level2-node' : 'level3-node';
            node.className = className;
            node.textContent = module.title;
            node.style.left = x + 'px';
            node.style.top = y + 'px';
            node.dataset.moduleId = module.id;
            
            if (app.expandedNodes.has(module.id)) {
                node.classList.add('expanded');
            }

            node.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleNode(module.id);
                showDetails(module);
            });

            container.appendChild(node);
        }

        // æ¸²æŸ“è¿æ¥çº¿
        function renderConnection(svg, x1, y1, x2, y2) {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);
            line.classList.add('connection-line');
            svg.appendChild(line);
        }

        // åˆ‡æ¢èŠ‚ç‚¹å±•å¼€/æ”¶èµ·
        function toggleNode(nodeId) {
            if (app.expandedNodes.has(nodeId)) {
                app.expandedNodes.delete(nodeId);
            } else {
                app.expandedNodes.add(nodeId);
            }
            renderMindmap();
        }

        // æ˜¾ç¤ºè¯¦æƒ…
        function showDetails(module) {
            const panel = document.getElementById('detailPanel');
            const title = document.getElementById('detailTitle');
            const content = document.getElementById('detailContent');

            title.textContent = module.title;
            
            let html = `<div class="detail-section">
                <h3>ğŸ“ æè¿°</h3>
                <p>${module.description}</p>
            </div>`;

            if (module.details) {
                Object.entries(module.details).forEach(([key, values]) => {
                    html += `<div class="detail-section">
                        <h3>${key}</h3>
                        <ul>`;
                    values.forEach(value => {
                        html += `<li>${value}</li>`;
                    });
                    html += `</ul></div>`;
                });
            }

            content.innerHTML = html;
            panel.classList.add('show');
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬
        function setupEventListeners() {
            // å…³é—­è¯¦æƒ…é¢æ¿
            document.getElementById('detailClose').addEventListener('click', () => {
                document.getElementById('detailPanel').classList.remove('show');
            });

            // å±•å¼€å…¨éƒ¨
            document.getElementById('expandAllBtn').addEventListener('click', () => {
                Object.keys(modules).forEach(key => {
                    app.expandedNodes.add(key);
                });
                renderMindmap();
            });

            // æ”¶èµ·å…¨éƒ¨
            document.getElementById('collapseAllBtn').addEventListener('click', () => {
                app.expandedNodes.clear();
                app.expandedNodes.add('root');
                renderMindmap();
            });

            // é‡ç½®è§†å›¾
            document.getElementById('resetViewBtn').addEventListener('click', () => {
                app.expandedNodes.clear();
                app.expandedNodes.add('root');
                app.selectedNode = null;
                document.getElementById('detailPanel').classList.remove('show');
                renderMindmap();
            });
        }

        // å¯åŠ¨
        init();
    </script>
</body>
</html>

