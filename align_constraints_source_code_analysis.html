<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Align å’Œ ConstrainedBox æºç çº§è®¾è®¡åˆ†æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header .back-btn {
            position: absolute;
            top: 30px;
            left: 30px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            border-left: 4px solid #667eea;
            padding-left: 15px;
        }

        .subsection-title {
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0 10px 0;
            color: #555;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 15px 0;
            line-height: 1.6;
        }

        .keyword {
            color: #66d9ef;
        }

        .string {
            color: #e6db74;
        }

        .number {
            color: #ae81ff;
        }

        .comment {
            color: #75715e;
        }

        .type {
            color: #a6e22e;
        }

        .decorator {
            color: #f92672;
        }

        .info-box {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 20px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .highlight-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .flow-diagram {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .flow-step {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }

        .step-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .step-code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 10px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .comparison-table th {
            background: #667eea;
            color: white;
        }

        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .key-point {
            background: #fffacd;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        .tree-view {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            line-height: 1.8;
        }

        .tree-view .indent {
            color: #999;
        }

        .tree-view .node {
            color: #333;
            font-weight: bold;
        }

        .tree-view .property {
            color: #666;
        }

        ul.styled-list {
            margin-left: 20px;
            line-height: 1.8;
        }

        ul.styled-list li {
            margin: 8px 0;
        }

        .note {
            font-size: 14px;
            color: #666;
            font-style: italic;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-btn">â† è¿”å›</a>
            <h1>ğŸ’» Align å’Œ ConstrainedBox æºç çº§è®¾è®¡åˆ†æ</h1>
            <p>æ·±å…¥ç†è§£ Flutter æºç å®ç°ï¼Œæ­ç§˜çº¦æŸä¼ é€’æœºåˆ¶</p>
        </div>

        <div class="content">
            <!-- Container æºç åˆ†æ -->
            <div class="section">
                <div class="section-title">1ï¸âƒ£ Container æºç åˆ†æ</div>
                
                <div class="info-box">
                    <strong>æºç ä½ç½®ï¼š</strong><code>flutter/lib/src/widgets/container.dart</code>
                </div>

                <div class="subsection-title">Container.build() æ–¹æ³•ï¼ˆç®€åŒ–ç‰ˆï¼‰</div>
                
                <div class="code-block">
<span class="decorator">@override</span>
<span class="type">Widget</span> <span class="keyword">build</span>(BuildContext context) {
  <span class="type">Widget?</span> current = child;

  <span class="comment">// 1. å¤„ç† alignmentï¼ˆæœ€å…ˆå¤„ç†ï¼‰</span>
  <span class="keyword">if</span> (alignment != <span class="keyword">null</span>) {
    current = <span class="type">Align</span>(
      alignment: alignment!,
      child: current,
    );
  }

  <span class="comment">// 2. å¤„ç† padding</span>
  <span class="keyword">if</span> (padding != <span class="keyword">null</span>) {
    current = <span class="type">Padding</span>(
      padding: padding!,
      child: current,
    );
  }

  <span class="comment">// 3. å¤„ç† constraintsï¼ˆåœ¨ alignment ä¹‹åï¼‰</span>
  <span class="keyword">if</span> (constraints != <span class="keyword">null</span>) {
    current = <span class="type">ConstrainedBox</span>(
      constraints: constraints!,
      child: current,
    );
  }

  <span class="comment">// 4. å¤„ç† decoration</span>
  <span class="keyword">if</span> (decoration != <span class="keyword">null</span>) {
    current = <span class="type">DecoratedBox</span>(
      decoration: decoration!,
      child: current,
    );
  }

  <span class="comment">// 5. å¤„ç† foregroundDecoration</span>
  <span class="keyword">if</span> (foregroundDecoration != <span class="keyword">null</span>) {
    current = <span class="type">DecoratedBox</span>(
      decoration: foregroundDecoration!,
      position: DecorationPosition.foreground,
      child: current,
    );
  }

  <span class="comment">// 6. å¤„ç† transform</span>
  <span class="keyword">if</span> (transform != <span class="keyword">null</span>) {
    current = <span class="type">Transform</span>(
      transform: transform!,
      alignment: transformAlignment,
      child: current,
    );
  }

  <span class="keyword">return</span> current ?? <span class="type">SizedBox</span>.shrink();
}
                </div>

                <div class="highlight-box">
                    <strong>ğŸ”‘ å…³é”®å‘ç°ï¼š</strong><br>
                    <ul class="styled-list">
                        <li><code>alignment</code> å‚æ•°<strong>æœ€å…ˆ</strong>è¢«å¤„ç†ï¼Œåˆ›å»º Align Widget</li>
                        <li><code>constraints</code> å‚æ•°<strong>å</strong>è¢«å¤„ç†ï¼Œåˆ›å»º ConstrainedBox</li>
                        <li>ConstrainedBox æ˜¯ Align çš„<strong>å­Widget</strong>ï¼Œè€Œä¸æ˜¯çˆ¶Widget</li>
                        <li>è¿™ç§é¡ºåºå¯¼è‡´ ConstrainedBox æ— æ³•çº¦æŸ Container çš„æœ€ç»ˆå°ºå¯¸</li>
                    </ul>
                </div>

                <div class="tree-view">
<span class="comment">// Widget æ ‘ç»“æ„ï¼ˆå½“åŒæ—¶è®¾ç½® alignment å’Œ constraintsï¼‰</span>
Container
<span class="indent">â””â”€â”€</span> <span class="node">Align</span> <span class="property">(å› ä¸º alignment != null)</span>
    <span class="indent">â””â”€â”€</span> <span class="node">Padding</span> <span class="property">(å¦‚æœæœ‰ padding)</span>
        <span class="indent">â””â”€â”€</span> <span class="node">ConstrainedBox</span> <span class="property">(å› ä¸º constraints != null)</span>
            <span class="indent">â””â”€â”€</span> <span class="node">DecoratedBox</span> <span class="property">(å¦‚æœæœ‰ decoration)</span>
                <span class="indent">â””â”€â”€</span> <span class="node">child</span>
                </div>
            </div>

            <!-- Align æºç åˆ†æ -->
            <div class="section">
                <div class="section-title">2ï¸âƒ£ Align æºç åˆ†æ</div>

                <div class="info-box">
                    <strong>æºç ä½ç½®ï¼š</strong>
                    <ul style="margin-top: 10px;">
                        <li>Widget: <code>flutter/lib/src/widgets/basic.dart</code></li>
                        <li>RenderObject: <code>flutter/lib/src/rendering/shifted_box.dart</code></li>
                    </ul>
                </div>

                <div class="subsection-title">2.1 Align Widget å®šä¹‰</div>

                <div class="code-block">
<span class="keyword">class</span> <span class="type">Align</span> <span class="keyword">extends</span> <span class="type">SingleChildRenderObjectWidget</span> {
  <span class="keyword">const</span> <span class="type">Align</span>({
    Key? key,
    <span class="keyword">this</span>.alignment = Alignment.center,
    <span class="keyword">this</span>.widthFactor,  <span class="comment">// å®½åº¦å› å­ï¼ˆnull è¡¨ç¤ºå¡«æ»¡ï¼‰</span>
    <span class="keyword">this</span>.heightFactor, <span class="comment">// é«˜åº¦å› å­ï¼ˆnull è¡¨ç¤ºå¡«æ»¡ï¼‰</span>
    Widget? child,
  }) : <span class="keyword">super</span>(key: key, child: child);

  <span class="keyword">final</span> <span class="type">AlignmentGeometry</span> alignment;
  <span class="keyword">final</span> <span class="type">double?</span> widthFactor;
  <span class="keyword">final</span> <span class="type">double?</span> heightFactor;

  <span class="decorator">@override</span>
  <span class="type">RenderPositionedBox</span> createRenderObject(BuildContext context) {
    <span class="keyword">return</span> <span class="type">RenderPositionedBox</span>(
      alignment: alignment,
      widthFactor: widthFactor,
      heightFactor: heightFactor,
      textDirection: Directionality.maybeOf(context),
    );
  }
}
                </div>

                <div class="warning-box">
                    <strong>âš ï¸ å…³é”®å‚æ•°ï¼š</strong><br>
                    <ul class="styled-list">
                        <li><code>widthFactor</code> å’Œ <code>heightFactor</code> é»˜è®¤ä¸º <strong>null</strong></li>
                        <li>å½“ factor ä¸º null æ—¶ï¼ŒAlign <strong>å¡«æ»¡çˆ¶Widgetçš„çº¦æŸ</strong></li>
                        <li>å½“ factor ä¸ä¸º null æ—¶ï¼Œå°ºå¯¸ = childå°ºå¯¸ Ã— factor</li>
                        <li>Container åˆ›å»º Align æ—¶ï¼Œ<strong>æ²¡æœ‰è®¾ç½®</strong> widthFactor å’Œ heightFactor</li>
                    </ul>
                </div>

                <div class="subsection-title">2.2 RenderPositionedBox æ ¸å¿ƒå®ç°</div>

                <div class="code-block">
<span class="keyword">class</span> <span class="type">RenderPositionedBox</span> <span class="keyword">extends</span> <span class="type">RenderAligningShiftedBox</span> {
  <span class="comment">// ...</span>

  <span class="comment">// æ ¸å¿ƒæ–¹æ³•1: performLayout - æ‰§è¡Œå¸ƒå±€</span>
  <span class="decorator">@override</span>
  <span class="keyword">void</span> performLayout() {
    <span class="keyword">final</span> <span class="type">BoxConstraints</span> constraints = <span class="keyword">this</span>.constraints;
    <span class="keyword">final</span> <span class="type">bool</span> shrinkWrapWidth = _widthFactor != <span class="keyword">null</span> || 
                                 constraints.maxWidth == <span class="type">double</span>.infinity;
    <span class="keyword">final</span> <span class="type">bool</span> shrinkWrapHeight = _heightFactor != <span class="keyword">null</span> || 
                                  constraints.maxHeight == <span class="type">double</span>.infinity;

    <span class="keyword">if</span> (child != <span class="keyword">null</span>) {
      <span class="comment">// 1ï¸âƒ£ ä¼ é€’ Loose Constraints ç»™å­Widget</span>
      child!.layout(constraints.loosen(), parentUsesSize: <span class="keyword">true</span>);
      
      <span class="comment">// 2ï¸âƒ£ ç¡®å®šè‡ªå·±çš„å°ºå¯¸</span>
      size = constraints.constrain(<span class="type">Size</span>(
        shrinkWrapWidth 
          ? child!.size.width * (_widthFactor ?? <span class="number">1.0</span>)
          : <span class="type">double</span>.infinity,  <span class="comment">// âš ï¸ å…³é”®ï¼šå¡«æ»¡æœ€å¤§å®½åº¦</span>
        shrinkWrapHeight 
          ? child!.size.height * (_heightFactor ?? <span class="number">1.0</span>)
          : <span class="type">double</span>.infinity,  <span class="comment">// âš ï¸ å…³é”®ï¼šå¡«æ»¡æœ€å¤§é«˜åº¦</span>
      ));
      
      <span class="comment">// 3ï¸âƒ£ å¯¹é½å­Widget</span>
      alignChild();
    } <span class="keyword">else</span> {
      <span class="comment">// æ²¡æœ‰å­Widgetï¼Œæ”¶ç¼©åˆ°æœ€å°</span>
      size = constraints.constrain(
        Size(
          shrinkWrapWidth ? <span class="number">0.0</span> : <span class="type">double</span>.infinity,
          shrinkWrapHeight ? <span class="number">0.0</span> : <span class="type">double</span>.infinity,
        ),
      );
    }
  }
}
                </div>

                <div class="highlight-box">
                    <strong>ğŸ”‘ æ ¸å¿ƒé€»è¾‘è§£æï¼š</strong><br><br>
                    
                    <strong>1. constraints.loosen()</strong><br>
                    å°†çˆ¶çº¦æŸè½¬æ¢ä¸º Loose Constraintsï¼ˆminWidth å’Œ minHeight è®¾ä¸º 0ï¼‰ï¼š
                    <div class="step-code">
// åŸçº¦æŸ: 0 â‰¤ width â‰¤ 300, 0 â‰¤ height â‰¤ 300
// loosen() å: 0 â‰¤ width â‰¤ 300, 0 â‰¤ height â‰¤ 300 (å·²ç»æ˜¯ loose)
                    </div>

                    <strong>2. å°ºå¯¸è®¡ç®—</strong><br>
                    å½“ widthFactor å’Œ heightFactor éƒ½ä¸º null æ—¶ï¼š
                    <div class="step-code">
size = constraints.constrain(Size(
  double.infinity,  // å®½åº¦è®¾ä¸ºæ— ç©·å¤§
  double.infinity,  // é«˜åº¦è®¾ä¸ºæ— ç©·å¤§
));

// constraints.constrain() ä¼šå°†æ— ç©·å¤§çº¦æŸåˆ° maxWidth/maxHeight
// ç»“æœï¼šsize = Size(300, 300)  // å¡«æ»¡çˆ¶çº¦æŸï¼
                    </div>

                    <strong>3. alignChild()</strong><br>
                    æ ¹æ® alignment å‚æ•°å°†å­Widgetå®šä½åœ¨ Align å†…éƒ¨ã€‚
                </div>

                <div class="subsection-title">2.3 BoxConstraints.loosen() æ–¹æ³•</div>

                <div class="code-block">
<span class="keyword">class</span> <span class="type">BoxConstraints</span> {
  <span class="comment">// å°†çº¦æŸè½¬æ¢ä¸º Loose Constraints</span>
  <span class="type">BoxConstraints</span> loosen() {
    <span class="keyword">return</span> <span class="type">BoxConstraints</span>(
      minWidth: <span class="number">0.0</span>,        <span class="comment">// âš ï¸ æœ€å°å®½åº¦è®¾ä¸º 0</span>
      maxWidth: maxWidth,    <span class="comment">// ä¿æŒæœ€å¤§å®½åº¦</span>
      minHeight: <span class="number">0.0</span>,       <span class="comment">// âš ï¸ æœ€å°é«˜åº¦è®¾ä¸º 0</span>
      maxHeight: maxHeight,  <span class="comment">// ä¿æŒæœ€å¤§é«˜åº¦</span>
    );
  }
}
                </div>
            </div>

            <!-- ConstrainedBox æºç åˆ†æ -->
            <div class="section">
                <div class="section-title">3ï¸âƒ£ ConstrainedBox æºç åˆ†æ</div>

                <div class="info-box">
                    <strong>æºç ä½ç½®ï¼š</strong>
                    <ul style="margin-top: 10px;">
                        <li>Widget: <code>flutter/lib/src/widgets/basic.dart</code></li>
                        <li>RenderObject: <code>flutter/lib/src/rendering/proxy_box.dart</code></li>
                    </ul>
                </div>

                <div class="subsection-title">3.1 ConstrainedBox Widget å®šä¹‰</div>

                <div class="code-block">
<span class="keyword">class</span> <span class="type">ConstrainedBox</span> <span class="keyword">extends</span> <span class="type">SingleChildRenderObjectWidget</span> {
  <span class="keyword">const</span> <span class="type">ConstrainedBox</span>({
    Key? key,
    <span class="keyword">required</span> <span class="keyword">this</span>.constraints,
    Widget? child,
  }) : <span class="keyword">super</span>(key: key, child: child);

  <span class="keyword">final</span> <span class="type">BoxConstraints</span> constraints;

  <span class="decorator">@override</span>
  <span class="type">RenderConstrainedBox</span> createRenderObject(BuildContext context) {
    <span class="keyword">return</span> <span class="type">RenderConstrainedBox</span>(
      additionalConstraints: constraints,
    );
  }
}
                </div>

                <div class="subsection-title">3.2 RenderConstrainedBox æ ¸å¿ƒå®ç°</div>

                <div class="code-block">
<span class="keyword">class</span> <span class="type">RenderConstrainedBox</span> <span class="keyword">extends</span> <span class="type">RenderProxyBox</span> {
  <span class="type">RenderConstrainedBox</span>({
    RenderBox? child,
    <span class="keyword">required</span> <span class="type">BoxConstraints</span> additionalConstraints,
  }) : _additionalConstraints = additionalConstraints,
       <span class="keyword">super</span>(child);

  <span class="type">BoxConstraints</span> _additionalConstraints;

  <span class="comment">// æ ¸å¿ƒæ–¹æ³•: performLayout - æ‰§è¡Œå¸ƒå±€</span>
  <span class="decorator">@override</span>
  <span class="keyword">void</span> performLayout() {
    <span class="keyword">if</span> (child != <span class="keyword">null</span>) {
      <span class="comment">// 1ï¸âƒ£ åˆå¹¶çº¦æŸï¼šçˆ¶çº¦æŸ enforce additionalConstraints</span>
      child!.layout(
        _additionalConstraints.enforce(constraints),
        parentUsesSize: <span class="keyword">true</span>,
      );
      
      <span class="comment">// 2ï¸âƒ£ ConstrainedBox çš„å°ºå¯¸ = å­Widgetçš„å°ºå¯¸</span>
      size = child!.size;
    } <span class="keyword">else</span> {
      <span class="comment">// æ²¡æœ‰å­Widgetï¼Œä½¿ç”¨çº¦æŸçš„æœ€å°å°ºå¯¸</span>
      size = _additionalConstraints.enforce(constraints).constrain(Size.zero);
    }
  }
}
                </div>

                <div class="subsection-title">3.3 BoxConstraints.enforce() æ–¹æ³•</div>

                <div class="code-block">
<span class="keyword">class</span> <span class="type">BoxConstraints</span> {
  <span class="comment">// åˆå¹¶ä¸¤ä¸ªçº¦æŸï¼Œå–æ›´ä¸¥æ ¼çš„é™åˆ¶</span>
  <span class="type">BoxConstraints</span> enforce(<span class="type">BoxConstraints</span> constraints) {
    <span class="keyword">return</span> <span class="type">BoxConstraints</span>(
      <span class="comment">// æœ€å°å€¼å–ä¸¤è€…çš„æœ€å¤§å€¼</span>
      minWidth: minWidth.clamp(constraints.minWidth, constraints.maxWidth),
      maxWidth: maxWidth.clamp(constraints.minWidth, constraints.maxWidth),
      minHeight: minHeight.clamp(constraints.minHeight, constraints.maxHeight),
      maxHeight: maxHeight.clamp(constraints.minHeight, constraints.maxHeight),
    );
  }
}

<span class="comment">// ç¤ºä¾‹ï¼š</span>
<span class="comment">// çˆ¶çº¦æŸ: BoxConstraints(0, 300, 0, 300)</span>
<span class="comment">// additionalConstraints: BoxConstraints(0, 100, 0, 100)</span>
<span class="comment">// ç»“æœ: BoxConstraints(0, 100, 0, 100)  // å–æ›´ä¸¥æ ¼çš„é™åˆ¶</span>
                </div>

                <div class="highlight-box">
                    <strong>ğŸ”‘ ConstrainedBox çš„å·¥ä½œåŸç†ï¼š</strong><br><br>
                    
                    <strong>1. åˆå¹¶çº¦æŸ</strong><br>
                    ä½¿ç”¨ <code>enforce()</code> æ–¹æ³•åˆå¹¶çˆ¶çº¦æŸå’Œè‡ªèº«çº¦æŸï¼Œå–æ›´ä¸¥æ ¼çš„é™åˆ¶ï¼š
                    <div class="step-code">
// çˆ¶çº¦æŸ: 0 â‰¤ width â‰¤ 300 (æ¥è‡ª Align)
// è‡ªèº«çº¦æŸ: 0 â‰¤ width â‰¤ 100 (additionalConstraints)
// åˆå¹¶å: 0 â‰¤ width â‰¤ 100 (å– min(300, 100) = 100)
                    </div>

                    <strong>2. ä¼ é€’ç»™å­Widget</strong><br>
                    å°†åˆå¹¶åçš„çº¦æŸä¼ é€’ç»™å­Widgetã€‚

                    <strong>3. è‡ªèº«å°ºå¯¸</strong><br>
                    ConstrainedBox çš„å°ºå¯¸<strong>ç­‰äº</strong>å­Widgetçš„å°ºå¯¸ï¼ˆä¸ä¼šé¢å¤–å ç”¨ç©ºé—´ï¼‰ã€‚
                </div>
            </div>

            <!-- å®Œæ•´å¸ƒå±€æµç¨‹ -->
            <div class="section">
                <div class="section-title">4ï¸âƒ£ å®Œæ•´å¸ƒå±€æµç¨‹ï¼ˆæºç çº§åˆ«ï¼‰</div>

                <div class="flow-diagram">
                    <h4 style="margin-bottom: 15px;">åœºæ™¯ï¼šContainer åŒæ—¶è®¾ç½® alignment å’Œ constraints</h4>

                    <div class="flow-step">
                        <div class="step-title">æ­¥éª¤1: çˆ¶Widgetä¼ é€’çº¦æŸç»™ Container</div>
                        <div class="step-code">
// çˆ¶Widget â†’ Container
constraints = BoxConstraints(
  minWidth: 0, maxWidth: 300,
  minHeight: 0, maxHeight: 300,
)
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-title">æ­¥éª¤2: Container.build() åˆ›å»º Widget æ ‘</div>
                        <div class="step-code">
// Container å†…éƒ¨åˆ›å»ºï¼š
Align(
  alignment: Alignment.center,
  child: ConstrainedBox(
    constraints: BoxConstraints(maxWidth: 100, maxHeight: 100),
    child: Text('Hello'),
  ),
)
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-title">æ­¥éª¤3: RenderPositionedBox.performLayout() - Align å¸ƒå±€</div>
                        <div class="step-code">
// 1. åˆ›å»º Loose Constraints
looseConstraints = constraints.loosen()
// ç»“æœ: BoxConstraints(0, 300, 0, 300)

// 2. ä¼ é€’ç»™å­Widget (ConstrainedBox)
child.layout(looseConstraints, parentUsesSize: true)

// 3. è®¡ç®—è‡ªå·±çš„å°ºå¯¸ï¼ˆwidthFactor å’Œ heightFactor éƒ½æ˜¯ nullï¼‰
size = constraints.constrain(Size(
  double.infinity,  // æ— ç©·å¤§
  double.infinity,  // æ— ç©·å¤§
))
// ç»“æœ: size = Size(300, 300)  âš ï¸ å¡«æ»¡çˆ¶çº¦æŸï¼
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-title">æ­¥éª¤4: RenderConstrainedBox.performLayout() - ConstrainedBox å¸ƒå±€</div>
                        <div class="step-code">
// 1. åˆå¹¶çº¦æŸ
parentConstraints = BoxConstraints(0, 300, 0, 300)  // æ¥è‡ª Align
additionalConstraints = BoxConstraints(0, 100, 0, 100)  // è‡ªå·±çš„çº¦æŸ

enforcedConstraints = additionalConstraints.enforce(parentConstraints)
// ç»“æœ: BoxConstraints(0, 100, 0, 100)

// 2. ä¼ é€’ç»™å­Widget (Text)
child.layout(enforcedConstraints, parentUsesSize: true)

// 3. è‡ªå·±çš„å°ºå¯¸ = å­Widgetçš„å°ºå¯¸
size = child.size  // å‡è®¾ Text æ˜¯ Size(50, 20)
// ç»“æœ: size = Size(50, 20)
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-title">æ­¥éª¤5: å°ºå¯¸å‘ä¸Šè¿”å›</div>
                        <div class="step-code">
Text: Size(50, 20)
  â†‘
ConstrainedBox: Size(50, 20)
  â†‘
Align (RenderPositionedBox): Size(300, 300)  âš ï¸
  â†‘
Container: Size(300, 300)  âŒ è€Œä¸æ˜¯æœŸæœ›çš„ 100Ã—100
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="step-title">æ­¥éª¤6: Align å®šä½å­Widget</div>
                        <div class="step-code">
// RenderPositionedBox.alignChild()
// å°† ConstrainedBox (50Ã—20) åœ¨ Align (300Ã—300) ä¸­å±…ä¸­
childParentData.offset = Offset(
  (300 - 50) / 2,  // x = 125
  (300 - 20) / 2,  // y = 140
)
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸ºä»€ä¹ˆ Align å¡«æ»¡çˆ¶çº¦æŸ -->
            <div class="section">
                <div class="section-title">5ï¸âƒ£ ä¸ºä»€ä¹ˆ Align ä¼šå¡«æ»¡çˆ¶çº¦æŸï¼Ÿ</div>

                <div class="subsection-title">æ ¸å¿ƒä»£ç åˆ†æ</div>

                <div class="code-block">
<span class="comment">// RenderPositionedBox.performLayout() ä¸­çš„å…³é”®ä»£ç </span>

<span class="keyword">final</span> <span class="type">bool</span> shrinkWrapWidth = _widthFactor != <span class="keyword">null</span> || 
                             constraints.maxWidth == <span class="type">double</span>.infinity;
<span class="keyword">final</span> <span class="type">bool</span> shrinkWrapHeight = _heightFactor != <span class="keyword">null</span> || 
                              constraints.maxHeight == <span class="type">double</span>.infinity;

size = constraints.constrain(<span class="type">Size</span>(
  shrinkWrapWidth 
    ? child!.size.width * (_widthFactor ?? <span class="number">1.0</span>)
    : <span class="type">double</span>.infinity,  <span class="comment">// âš ï¸ è¿™é‡Œï¼</span>
  shrinkWrapHeight 
    ? child!.size.height * (_heightFactor ?? <span class="number">1.0</span>)
    : <span class="type">double</span>.infinity,  <span class="comment">// âš ï¸ è¿™é‡Œï¼</span>
));
                </div>

                <div class="info-box">
                    <h4>é€»è¾‘åˆ†æï¼š</h4>
                    <ul class="styled-list">
                        <li><strong>widthFactor ä¸º null</strong>ï¼šshrinkWrapWidth = false</li>
                        <li><strong>heightFactor ä¸º null</strong>ï¼šshrinkWrapHeight = false</li>
                        <li>å› æ­¤ï¼ŒSize è¢«è®¾ä¸º <code>Size(double.infinity, double.infinity)</code></li>
                        <li><code>constraints.constrain()</code> ä¼šå°†æ— ç©·å¤§é™åˆ¶åœ¨ maxWidth/maxHeight</li>
                        <li>æœ€ç»ˆç»“æœï¼š<strong>Align å¡«æ»¡çˆ¶çº¦æŸçš„æœ€å¤§å°ºå¯¸</strong></li>
                    </ul>
                </div>

                <div class="subsection-title">è®¾è®¡æ„å›¾</div>

                <div class="success-box">
                    <h4>Align çš„è®¾è®¡ç›®æ ‡ï¼š</h4>
                    <ul class="styled-list">
                        <li><strong>é»˜è®¤è¡Œä¸º</strong>ï¼šå¡«æ»¡çˆ¶Widgetï¼Œåœ¨å…¶ä¸­å¯¹é½å­Widget</li>
                        <li><strong>å¯é€‰æ”¶ç¼©</strong>ï¼šé€šè¿‡ widthFactor/heightFactor æ§åˆ¶å°ºå¯¸</li>
                        <li><strong>çµæ´»æ€§</strong>ï¼šé€‚åº”ä¸åŒçš„ä½¿ç”¨åœºæ™¯</li>
                    </ul>

                    <h4 style="margin-top: 15px;">ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</h4>
                    <p style="margin-top: 10px;">
                        Align çš„ä¸»è¦ç”¨é€”æ˜¯<strong>åœ¨å¯ç”¨ç©ºé—´å†…å¯¹é½å­Widget</strong>ã€‚å¦‚æœ Align æ”¶ç¼©åˆ°å­Widgetçš„å°ºå¯¸ï¼Œ
                        å°±å¤±å»äº†"å¯¹é½"çš„æ„ä¹‰ï¼ˆå› ä¸ºæ²¡æœ‰é¢å¤–ç©ºé—´æ¥è¿›è¡Œå¯¹é½ï¼‰ã€‚
                    </p>
                </div>

                <div class="subsection-title">å¦‚ä½•è®© Align ä¸å¡«æ»¡ï¼Ÿ</div>

                <div class="code-block">
<span class="comment">// æ–¹æ³•1: è®¾ç½® widthFactor å’Œ heightFactor</span>
<span class="type">Align</span>(
  alignment: Alignment.center,
  widthFactor: <span class="number">1.0</span>,   <span class="comment">// å®½åº¦ = childå®½åº¦ Ã— 1.0</span>
  heightFactor: <span class="number">1.0</span>,  <span class="comment">// é«˜åº¦ = childé«˜åº¦ Ã— 1.0</span>
  child: <span class="type">Text</span>(<span class="string">'Hello'</span>),
)
<span class="comment">// ç»“æœï¼šAlign çš„å°ºå¯¸ç­‰äº child çš„å°ºå¯¸</span>

<span class="comment">// æ–¹æ³•2: ä½¿ç”¨ Center (å®ƒå°±æ˜¯ widthFactor/heightFactor = null çš„ Align)</span>
<span class="type">Center</span>(child: <span class="type">Text</span>(<span class="string">'Hello'</span>))
<span class="comment">// ç­‰ä»·äºï¼š</span>
<span class="type">Align</span>(
  alignment: Alignment.center,
  widthFactor: <span class="keyword">null</span>,   <span class="comment">// å¡«æ»¡å®½åº¦</span>
  heightFactor: <span class="keyword">null</span>,  <span class="comment">// å¡«æ»¡é«˜åº¦</span>
  child: <span class="type">Text</span>(<span class="string">'Hello'</span>),
)
                </div>
            </div>

            <!-- å¯¹æ¯”æ€»ç»“ -->
            <div class="section">
                <div class="section-title">6ï¸âƒ£ Align vs ConstrainedBox å¯¹æ¯”</div>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>ç‰¹æ€§</th>
                            <th>Align</th>
                            <th>ConstrainedBox</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ä¸»è¦ç”¨é€”</strong></td>
                            <td>åœ¨å¯ç”¨ç©ºé—´å†…å¯¹é½å­Widget</td>
                            <td>é™åˆ¶å­Widgetçš„çº¦æŸèŒƒå›´</td>
                        </tr>
                        <tr>
                            <td><strong>çº¦æŸä¼ é€’</strong></td>
                            <td>ä¼ é€’ Loose Constraintsï¼ˆminWidth/Height = 0ï¼‰</td>
                            <td>åˆå¹¶çˆ¶çº¦æŸå’Œè‡ªèº«çº¦æŸï¼ˆå–æ›´ä¸¥æ ¼çš„ï¼‰</td>
                        </tr>
                        <tr>
                            <td><strong>è‡ªèº«å°ºå¯¸</strong></td>
                            <td>é»˜è®¤å¡«æ»¡çˆ¶çº¦æŸï¼ˆé™¤éè®¾ç½® factorï¼‰</td>
                            <td>ç­‰äºå­Widgetçš„å°ºå¯¸</td>
                        </tr>
                        <tr>
                            <td><strong>å¯¹å­Widgetçš„å½±å“</strong></td>
                            <td>å…è®¸å­Widgetè‡ªç”±é€‰æ‹©å°ºå¯¸ï¼ˆåœ¨çº¦æŸèŒƒå›´å†…ï¼‰</td>
                            <td>é™åˆ¶å­Widgetçš„æœ€å¤§/æœ€å°å°ºå¯¸</td>
                        </tr>
                        <tr>
                            <td><strong>æ€§èƒ½</strong></td>
                            <td>éœ€è¦è®¡ç®—å¯¹é½ä½ç½®</td>
                            <td>ç®€å•çš„çº¦æŸåˆå¹¶</td>
                        </tr>
                        <tr>
                            <td><strong>RenderObject</strong></td>
                            <td>RenderPositionedBox</td>
                            <td>RenderConstrainedBox (ç»§æ‰¿è‡ª RenderProxyBox)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- æ€»ç»“ -->
            <div class="section">
                <div class="section-title">7ï¸âƒ£ æ€»ç»“</div>

                <div class="success-box">
                    <h4>ğŸ¯ æ ¸å¿ƒåŸå› ï¼ˆæºç çº§åˆ«ï¼‰ï¼š</h4>
                    <ol class="styled-list">
                        <li><strong>Container çš„ build() é¡ºåº</strong>ï¼šå…ˆå¤„ç† alignmentï¼ˆåˆ›å»º Alignï¼‰ï¼Œåå¤„ç† constraintsï¼ˆåˆ›å»º ConstrainedBoxï¼‰</li>
                        <li><strong>Align çš„è®¾è®¡</strong>ï¼šå½“ widthFactor/heightFactor ä¸º null æ—¶ï¼Œsize = Size(infinity, infinity)ï¼Œè¢« constrain() åå¡«æ»¡çˆ¶çº¦æŸ</li>
                        <li><strong>ConstrainedBox çš„ä½ç½®</strong>ï¼šåœ¨ Align å†…éƒ¨ï¼Œåªèƒ½çº¦æŸå®ƒçš„å­Widgetï¼Œæ— æ³•å½±å“ Align çš„å°ºå¯¸</li>
                        <li><strong>çº¦æŸä¼ é€’æ–¹å‘</strong>ï¼šåªèƒ½ä»çˆ¶åˆ°å­ï¼ŒConstrainedBox æ— æ³•"å‘ä¸Š"çº¦æŸ Align</li>
                    </ol>
                </div>

                <div class="warning-box">
                    <h4>âš ï¸ å…³é”®çŸ¥è¯†ç‚¹ï¼š</h4>
                    <ul class="styled-list">
                        <li><code>Align.performLayout()</code> ä¸­ï¼Œå½“ factor ä¸º null æ—¶ï¼Œä¼šè®¾ç½® <code>size = infinity</code></li>
                        <li><code>constraints.constrain(Size(infinity, infinity))</code> ä¼šè¿”å› <code>Size(maxWidth, maxHeight)</code></li>
                        <li><code>ConstrainedBox.performLayout()</code> ä¸­ï¼Œ<code>size = child.size</code>ï¼Œä¸ä¼šé¢å¤–å ç”¨ç©ºé—´</li>
                        <li>Widget æ ‘çš„åµŒå¥—é¡ºåºå†³å®šäº†çº¦æŸä¼ é€’çš„æ–¹å‘å’Œç»“æœ</li>
                    </ul>
                </div>

                <div class="info-box">
                    <h4>ğŸ’¡ æœ€ä½³å®è·µï¼š</h4>
                    <ul class="styled-list">
                        <li>ç†è§£æ¯ä¸ª Widget çš„æºç å®ç°å’Œå¸ƒå±€é€»è¾‘</li>
                        <li>æ³¨æ„ Widget æ ‘çš„æ„å»ºé¡ºåº</li>
                        <li>é¿å…åœ¨ Container ä¸­åŒæ—¶ä½¿ç”¨ alignment å’Œ constraints</li>
                        <li>éœ€è¦çº¦æŸå°ºå¯¸æ—¶ï¼Œåœ¨ Container å¤–éƒ¨ä½¿ç”¨ ConstrainedBox æˆ– SizedBox</li>
                        <li>ä½¿ç”¨ <code>widthFactor</code>/<code>heightFactor</code> æ§åˆ¶ Align çš„å°ºå¯¸</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

